{"version":3,"sources":["../../components/chat/ChatUI.jsx"],"names":[],"mappings":"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","file":"ChatUI.js","sourcesContent":["var ChatUI = React.createClass({\n  getDefaultProps: function() {\n    return ({\n      'historyMaxDaysBack': 20\n    })\n  },\n  loadUpdates: function() {\n    $.ajax({\n      type: \"POST\",\n      url: '/get_history',\n      data: {\n        'timestamp': self.initialFetch\n      },\n      dataType: 'json',\n      success: function(msg) {\n        var timestamp = msg.timestamp;\n        var historyData = self.sortByDateProp(msg.results, 'last_activity_date');\n\n        this.setState({data:historyData});\n        self.lastFetch = timestamp;\n        var currentreact = this;\n\n        if (!self.activeConvoNotSet) {\n          var target_match = this.state.convo['_id'];\n          $.each(historyData, function(idx, val){\n            if(val['_id'] == target_match) {\n              currentreact.setState({'convo':val});\n              return false;\n            }\n          });\n        }\n      }.bind(this),\n      error: function(xhr, status, err) {\n        console.error(this.props.url, status, err.toString());\n      }.bind(this)\n    });\n  },\n  getInitialState: function() {\n    return {\n      data:[],\n      convo: {\n        \"_id\":\"\",\n        'messages':[\n          {'from':'', 'message':''}\n        ],\n        \"person\": {\n          \"photos\": [{\"processedFiles\":[{'url':''},{'url':''},{'url':''}]}]\n        }\n      }\n    };\n  },\n  historyLooper: function(callback) {\n    var lookup = {\n      \"3\": 7,\n      \"7\": 14,\n      \"14\":20,\n    };\n\n    var current_history = parseInt(self.lastDayFetch);\n    var next = lookup[current_history];\n\n    this.collectHistory(next, function(){\n      callback();\n    });\n\n  },\n  collectHistory: function(days_back, callback) {\n    var currentreact = this;\n    $.ajax({\n      type: \"POST\",\n      url: '/get_history',\n      data: {\n        'days_ago': parseInt(days_back)\n      },\n      dataType: 'json',\n      success: function(msg) {\n        var timestamp = msg.timestamp;\n        var historyData = Global.sortByDateProp(msg.results, 'last_activity_date');\n\n        currentreact.props.lastFetch = timestamp;\n        currentreact.props.initialFetch = timestamp;\n        currentreact.props.lastDayFetch = days_back;\n\n        if(self.activeConvoNotSet) {\n          $.each(historyData, function(idx, val){\n            if(val.messages.length>0) {\n              self.activeConvoNotSet = false;\n\n              currentreact.setState({\n                data:historyData,\n                convo:val\n              })\n            }\n          });\n          if(self.activeConvoNotSet === true) {\n            currentreact.setState({data:historyData});\n          }\n          callback();\n        } else {\n          currentreact.setState({data:historyData});\n        }\n\n      }.bind(this),\n      error: function(xhr, status, err) {\n        console.error(this.props.url, status, err.toString());\n      }.bind(this)\n    });\n  },\n  quickFetch: function() {\n    this.loadUpdates();\n  },\n  componentDidMount: function() {\n    console.log('mounted');\n    var currentreact = this;\n    $.ajax({\n      type: \"POST\",\n      url: '/get_history',\n      data: {\n        'days_ago': 3\n      },\n      dataType: 'json',\n      success: function(msg) {\n        var timestamp = msg.timestamp;\n        var historyData = msg.results;\n\n        this.props.lastFetch = timestamp;\n        this.props.initialFetch = timestamp;\n        this.props.lastDayFetch = 3;\n        this.props.activeConvoNotSet = true;\n        $.each(historyData, function(idx, val){\n          if(val.messages.length>0) {\n            this.activeConvoNotSet = false;\n\n            currentreact.setState({\n              data:historyData,\n              convo:val\n            })\n          }\n        });\n        if(this.activeConvoNotSet === true) {\n          currentreact.setState({data:historyData});\n        }\n\n        setInterval(this.loadUpdates, 5000);\n\n        var activereact = this;\n        function loop() {\n\n          if(this.props.lastDayFetch != this.props.historyMaxDaysBack) {\n            activereact.historyLooper(function(){\n              loop();\n            });\n          }\n        }\n        loop();\n      }.bind(this),\n      error: function(xhr, status, err) {\n        console.error(this.props.url, status, err.toString());\n      }.bind(this)\n    });\n  },\n  setNewConvo: function(match) {\n    this.setState({convo:match.match});\n  },\n  render: function() {\n    return (\n      <div className=\"chatUI mainPage\" data-active={this.props.active}>\n        <MatchList data={this.state.data} activeConvo={this.state.convo} setNewConvo={this.setNewConvo} />\n        <ActiveConvo triggerHistory={this.quickFetch} match={this.state.convo} />\n        <ConvoPhotos match={this.state.convo} />\n      </div>\n    )\n  }\n});\n"]}