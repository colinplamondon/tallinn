{"version":3,"sources":["chat.jsx"],"names":[],"mappings":"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","file":"chat.js","sourcesContent":["/*jshint sub:true*/\n/*jshint -W030 */\n\n// ChatUI\n//   MatchList\n//     MatchCell\n//   ActiveConvo\n//     ConvoHistoryBox\n//       MessageBubble\n//     MessageInput\n//   ConvoPhotos\n\nfunction ChatClass() {\n  this.url = \"/chat\";\n  this.historyMaxDaysBack = 14;\n  this.init = function(){\n    this.installObservers();\n    this.createReact();\n\t};\n\n  this.sortByDateProp = function(target_list, prop) {\n    return target_list.sort(function(a, b){\n      return Date.parse(b[prop]) - Date.parse(a[prop]);\n    })\n\n  };\n\n  this.createReact = function() {\n    var self = this;\n\n    var ChatUI = React.createClass({\n      loadUpdates: function() {\n        $.ajax({\n          type: \"POST\",\n          url: '/get_history',\n          data: {\n            'timestamp': self.initialFetch\n          },\n          dataType: 'json',\n          success: function(msg) {\n            var timestamp = msg.timestamp;\n            var historyData = self.sortByDateProp(msg.results, 'last_activity_date');\n\n            this.setState({data:historyData});\n            self.lastFetch = timestamp;\n          }.bind(this),\n          error: function(xhr, status, err) {\n            console.error(this.props.url, status, err.toString());\n          }.bind(this)\n        });\n      },\n      getInitialState: function() {\n        return {data:[],convo:{'messages':[\n          {'from':'', 'message':''}\n        ]}};\n      },\n      historyLooper: function(callback) {\n        var lookup = {\n          \"3\": 7,\n          \"7\": 14,\n          \"14\":20,\n        };\n\n        var current_history = parseInt(self.lastDayFetch);\n        var next = lookup[current_history];\n\n        if (next == 20) {\n          setInterval(this.loadUpdates, 5000);\n        }\n\n        this.collectHistory(next, function(){\n          callback();\n        });\n\n      },\n      collectHistory: function(days_back, callback) {\n        $.ajax({\n          type: \"POST\",\n          url: '/get_history',\n          data: {\n            'days_ago': parseInt(days_back)\n          },\n          dataType: 'json',\n          success: function(msg) {\n            var timestamp = msg.timestamp;\n            var historyData = self.sortByDateProp(msg.results, 'last_activity_date');\n\n            self.lastFetch = timestamp;\n            self.initialFetch = timestamp;\n            self.lastDayFetch = days_back;\n            this.setState({data:historyData});\n            callback();\n\n          }.bind(this),\n          error: function(xhr, status, err) {\n            console.error(this.props.url, status, err.toString());\n          }.bind(this)\n        });\n      },\n      componentDidMount: function() {\n        console.log('mounted');\n        $.ajax({\n          type: \"POST\",\n          url: '/get_history',\n          data: {\n            'days_ago': 3\n          },\n          dataType: 'json',\n          success: function(msg) {\n            var timestamp = msg.timestamp;\n            var historyData = msg.results;\n\n            self.lastFetch = timestamp;\n            self.initialFetch = timestamp;\n            self.lastDayFetch = 3;\n            this.setState({data:historyData});\n\n            var activereact = this;\n            function loop() {\n\n              if(self.lastDayFetch != self.historyMaxDaysBack) {\n                activereact.historyLooper(function(){\n                  loop();\n                });\n              }\n            }\n            loop();\n          }.bind(this),\n          error: function(xhr, status, err) {\n            console.error(this.props.url, status, err.toString());\n          }.bind(this)\n        });\n      },\n      setNewConvo: function(match) {\n        this.setState({convo:match.match});\n      },\n      render: function() {\n        console.log('rendering...');\n        console.log(this.state.convo);\n        return (\n          <div className=\"chatUI\">\n            <MatchList data={this.state.data} setNewConvo={this.setNewConvo} />\n            <ActiveConvo match={this.state.convo} />\n            <ConvoPhotos match={this.state.convo} />\n          </div>\n        )\n      }\n    });\n\n    var MatchList = React.createClass({\n      matchChangeHandler: function(match, x) {\n        console.log('intermediary step...');\n        console.log(x);\n        console.log(match);\n        this.props.setNewConvo({match:x});\n      },\n      render: function() {\n        var boundClick = this.matchChangeHandler.bind(null, this);\n        var matchNodes = this.props.data.map(function (match){\n          var last_three_messages = match['messages'].slice(-3);\n          var messaged = true;\n          if(match['messages'].length === 0) {\n            messaged = false\n          }\n          var last_messaged = moment(match.last_activity_date).fromNow();\n          var last_online = moment(match.person.ping_time).fromNow();\n\n          var messages_only = [];\n          $.each(last_three_messages, function(idx, val){\n            messages_only.push(val['message']);\n          });\n          return (\n            <MatchCell key={match._id}\n              profile={match['person']['photos'][0]['url']}\n              name={match['person']['name']}\n              last_three_messages={messages_only.join('<br />')}\n              messaged={messaged.toString()}\n              last_messaged={last_messaged}\n              last_online={last_online}\n              match_id={match['_id']}\n              match={match}\n              onMatchChange={boundClick} />\n          );\n        });\n        return  (\n          <div className=\"matchList col-md-4\">\n            {matchNodes}\n          </div>\n        )\n      }\n    });\n\n\n    var MatchCell = React.createClass({\n      handleClick: function(e) {\n        console.log(this.props.match);\n        console.log(this.props);\n        this.props.onMatchChange(this.props.match);\n      },\n      render: function() {\n        var messageExp = this.props.messaged === 'true' ? this.props['last_three_messages'] : 'no messages yet';\n        function createMessage() { return {\n          __html: messageExp\n        };}\n        return (\n          <div className=\"matchCell row\" onClick={this.handleClick} match_id={this.props['match_id']} messaged={this.props['messaged']}>\n            <img className=\"col-md-4\" src={this.props['profile']} />\n            <div className=\"col-md-8\">\n              <span className=\"name\">{this.props['name']}</span>\n              <span className=\"lastonline\">last online {this.props['last_online']}</span>\n              <p dangerouslySetInnerHTML={createMessage()} />\n            </div>\n          </div>\n        )\n      }\n    });\n\n    var ActiveConvo = React.createClass({\n      handleMessageSubmit: function(message) {\n        //\n      },\n      // getInitialState: function() {\n      //   return {match: {\n      //     'messages':[{'from':'', 'message':''}]\n      //   }};\n      // },\n      render: function() {\n        return (\n          <div className=\"activeConvo col-md-6\">\n            <ConvoHistoryBox match={this.props.match}/>\n            <MessageInput onMessageSubmit={this.handleMessageSubmit} />\n          </div>\n        )\n      }\n    })\n\n    var ConvoHistoryBox = React.createClass({\n      render: function() {\n        console.log('next is props');\n        console.log(this.props.match)\n        var messages = this.props.match['messages'];\n        var m = null;\n        if (this.props.match.hasOwnProperty('person')) {\n          m = this.props.match;\n        }\n        var started = 'false';\n        if(messages[0].from.length > 0) {\n          started = 'true';\n        }\n        console.log(messages);\n        var messageNodes = messages.map(function(message, idx){\n          var from = Global.tinderId == message['from'] ? \"me\" :\"them\";\n          var first = false;\n          if(idx === 0){\n            first = true;\n          } else if(from == 'them') {\n            first = messages[idx-1]['from'] == m.person._id ? false : true;\n          } else if (from == 'me') {\n            first = messages[idx-1]['from'] == Global.tinderId ? false : true;\n          }\n          var their_pic = ''\n          if (m) {\n            their_pic = m.person.photos[0].processedFiles[2].url;\n          }\n          console.log(started);\n          return (\n            <MessageBubble from={from}\n              text={message['message']}\n              first={first.toString()}\n              their_pic={their_pic}\n              started={started} />\n          );\n        });\n        return (\n          <div className=\"convoHistoryBox\">\n            {messageNodes}\n          </div>\n        )\n      }\n    });\n\n    var MessageBubble = React.createClass({\n      render: function() {\n        // var me = Global.tinderId;\n        // var them = x._id;\n        // var from = me == from ? \"me\" :\"them\";\n        return (\n          <div className=\"messageBubble row\" data-first={this.props.first} data-from={this.props.from} data-started={this.props.started}>\n            <div className=\"col-md-1 col-md-offset-1\">\n              <img className=\"mePhoto img-circle\" src={Global.profilePic} />\n            </div>\n            <div className=\"messageText col-md-8\">\n              <p>{this.props.text}</p>\n            </div>\n            <div className=\"col-md-1\">\n              <img className=\"themPhoto img-circle\" src={this.props.their_pic} />\n            </div>\n          </div>\n        )\n      }\n    });\n\n    var MessageInput = React.createClass({\n      render: function() {\n        return (\n          <div className=\"messageInput row\">\n            <img className=\"col-md-2\" src={Global.profilePic} />\n            <input className=\"col-md-7\" placeholder=\"Enter your message here\" type=\"text\" />\n            <div className=\"submit col-md-3\">send</div>\n          </div>\n        )\n      }\n    });\n\n    var ConvoPhotos = React.createClass({\n      render: function() {\n        return(\n            <div className=\"convoPhotos\" />\n        )\n      }\n    })\n\n    // REACT RENDER\n\n    ReactDOM.render(\n      <ChatUI data={this.historyData} />,\n      document.getElementById('chat-ui')\n    );  };\n\n\tthis.installObservers = function(){\n\t};\n\n}\n\nvar Chat = new ChatClass();\n\n// MatchList\n//   MatchCell\n"]}